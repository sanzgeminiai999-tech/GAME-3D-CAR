<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ultimate Car Game - Improved - by S4NZz</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      overflow: hidden;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Helvetica, Arial, sans-serif;
    }
    
    #gameArea {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(#111, #222);
      overflow: hidden;
    }
    
    .road {
      position: absolute;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        to bottom,
        #333 0px,
        #333 40px,
        #222 40px,
        #222 80px
      );
      /* Animasi jalan akan dikontrol oleh JS */
    }
    
    .center-line {
      position: absolute;
      left: 50%;
      width: 6px;
      height: 100%;
      background: repeating-linear-gradient(
        white 0px,
        white 20px,
        transparent 20px,
        transparent 40px
      );
      transform: translateX(-50%);
      opacity: 0.6;
      /* Animasi garis akan dikontrol oleh JS */
    }
    
    /* Base class untuk semua objek game */
    .car,
    .enemy,
    .coin,
    .boost,
    .shield,
    .truck {
      position: absolute;
      border-radius: 6px;
    }
    
    .car {
      width: 40px;
      height: 70px;
      background: linear-gradient(to top, #0077ff, #00ccff);
      border: 2px solid #0055aa;
      box-shadow: 0 0 10px #0ff;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      /* Transisi dihapus, gerakan dikontrol penuh oleh JS */
    }
    
    /* Kaca depan mobil pemain */
    .car::before {
      content: "";
      position: absolute;
      top: 10px;
      left: 5px;
      width: 26px; /* 40px - 2*border - 2*5px */
      height: 20px;
      background: #aadeff;
      border-radius: 4px 4px 2px 2px;
      border: 2px solid #00aaff;
    }
    
    /* Efek visual saat perisai aktif */
    .car.shield-active {
      box-shadow: 0 0 20px 10px cyan;
      outline: 3px solid cyan;
    }
    
    /* Efek visual saat boost aktif */
    .car.boost-active {
      animation: pulse 0.2s infinite;
    }
    
    @keyframes pulse {
      0%,
      100% {
        transform: scale(1) translateX(-50%);
      }
      50% {
        transform: scale(1.05) translateX(-50%);
      }
    }
    
    .enemy {
      width: 40px; /* Samakan dengan pemain */
      height: 70px;
      background: linear-gradient(to top, #aa0000, #ff0000);
      border: 2px solid #550000;
    }
    
    /* Kaca depan mobil musuh */
    .enemy::before {
      content: "";
      position: absolute;
      top: 10px;
      left: 5px;
      width: 26px;
      height: 20px;
      background: #ffaaaa;
      border-radius: 4px 4px 2px 2px;
      border: 2px solid #dd0000;
    }
    
    /* Helper class untuk item */
    .coin,
    .boost,
    .shield {
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: rgba(0, 0, 0, 0.7);
      text-shadow: 0 0 2px white;
    }
    
    .coin {
      width: 30px;
      height: 30px;
      background: gold;
      border-radius: 50%;
      border: 3px solid orange;
      font-size: 20px;
      animation: spin 1.5s linear infinite;
    }
    .coin::before {
      content: "$";
    }
    @keyframes spin {
      100% {
        transform: rotateY(360deg);
      }
    }
    
    .boost {
      width: 35px;
      height: 60px;
      background: lime;
      border: 3px solid green;
      font-size: 30px;
    }
    .boost::before {
      content: "â†‘";
    }
    
    .shield {
      width: 40px;
      height: 40px;
      background: cyan;
      border: 3px solid blue;
      font-size: 24px;
    }
    .shield::before {
      content: "S";
    }
    
    .truck {
      /* Ganti .dino */
      width: 70px;
      height: 100px;
      background: linear-gradient(to top, #555, #888);
      border: 3px solid #333;
      border-radius: 8px;
      z-index: 5;
    }
    
    /* Kabin Truk */
    .truck::before {
      content: "";
      position: absolute;
      top: 5px;
      left: 5px;
      width: 58px; /* 70px - 2*border - 2*5px */
      height: 30px;
      background: #aaa;
      border-radius: 4px;
      border: 1px solid #444;
    }
    
    #leftBtn,
    #rightBtn {
      position: absolute;
      bottom: 20px;
      width: 60px;
      height: 60px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 40px;
      text-align: center;
      line-height: 60px; /* Perbaiki line-height */
      border-radius: 100%;
      user-select: none;
      z-index: 100;
      cursor: pointer;
    }
    
    #leftBtn:active,
    #rightBtn:active {
      background: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }
    
    #leftBtn {
      left: 20px;
    }
    
    #rightBtn {
      right: 20px;
    }
    
    #score {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #0ff;
      font-size: 24px;
      font-weight: bold;
      z-index: 100;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 15px;
      border-radius: 10px;
    }
    
    /* Penampung untuk semua overlay (Start, Countdown, Game Over) */
    #startScreen,
    #countdown,
    #gameOverScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 199;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    
    #startScreen,
    #gameOverScreen {
      background: rgba(0, 0, 0, 0.9);
      color: #0ff;
    }
    
    #startScreen button,
    #gameOverScreen button {
      padding: 10px 30px;
      font-size: 39px;
      background: #0ff;
      border: none;
      border-radius: 30px;
      color: black;
      font-weight: bold;
      margin-top: 30px;
      cursor: pointer;
    }
    
    #startScreen button:active,
    #gameOverScreen button:active {
      transform: scale(0.95);
    }
    
    #countdown {
      font-size: 80px;
      color: #0ff;
      display: none;
      background: rgba(0, 0, 0, 0.3);
    }
    
    /* Layar Game Over Baru */
    #gameOverScreen {
      display: none; /* Sembunyikan secara default */
      color: #ff0000;
    }
    #gameOverScreen h2 {
      font-size: 48px;
    }
    #finalScore {
      font-size: 30px;
      color: white;
      margin: 20px 0;
    }
    #gameOverScreen button {
      background: #ff0000;
      color: white;
    }
  </style>
</head>

<body>
  <div id="gameArea">
    <div class="road"></div>
    <div class="center-line"></div>
    <div id="player" class="car"></div>
    <div id="score">Score: 0</div>
    <div id="leftBtn">â¬…</div>
    <div id="rightBtn">âž¡</div>
    
    <div id="startScreen">
      <h2>ðŸš— Ultimate Car Game by SANZz</h2>
      <button onclick="startCountdown()">Play</button>
    </div>
    
    <div id="countdown">3</div>
    
    <div id="gameOverScreen">
      <h2>ðŸ’¥ Game Over! ðŸ’¥</h2>
      <div id="finalScore">Final Score: 0</div>
      <button onclick="restartGame()">Play Again</button>
    </div>
  </div>
  
  <script>
    const player = document.getElementById("player");
    const leftBtn = document.getElementById("leftBtn");
    const rightBtn = document.getElementById("rightBtn");
    const gameArea = document.getElementById("gameArea");
    const scoreText = document.getElementById("score");
    const road = document.querySelector(".road");
    const centerLine = document.querySelector(".center-line");
    
    let px = window.innerWidth / 2 - 20;
    let enemies = [],
      coins = [],
      boosts = [],
      shields = [],
      trucks = []; // Ganti nama dari 'dinos'
      
    let score = 0,
      gameSpeed = 5; // Kecepatan dasar game
      
    let boostActive = false,
      shieldActive = false;
      
    let gameStarted = false;
    
    let leftPressed = false,
      rightPressed = false;
    let keyMap = { ArrowLeft: false, ArrowRight: false };
    
    let roadPos = 0,
      linePos = 0;
    
    // KONTROL SENTUH
    leftBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      leftPressed = true;
    });
    leftBtn.addEventListener("touchend", (e) => {
      e.preventDefault();
      leftPressed = false;
    });
    rightBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      rightPressed = true;
    });
    rightBtn.addEventListener("touchend", (e) => {
      e.preventDefault();
      rightPressed = false;
    });
    
    // KONTROL KEYBOARD
    window.addEventListener("keydown", (e) => {
      if (keyMap.hasOwnProperty(e.key)) {
        e.preventDefault();
        keyMap[e.key] = true;
      }
    });
    window.addEventListener("keyup", (e) => {
      if (keyMap.hasOwnProperty(e.key)) {
        e.preventDefault();
        keyMap[e.key] = false;
      }
    });
    
    function movePlayer(dir) {
      // Kecepatan gerak horizontal tetap, terpisah dari gameSpeed
      let moveSpeed = boostActive ? 10 : 6;
      px += dir * moveSpeed;
      
      // Batasi gerakan di dalam layar
      px = Math.max(0, Math.min(px, window.innerWidth - 40)); // 40 adalah lebar mobil
      player.style.left = px + "px";
    }
    
    function createObject(className, x, y) {
      const el = document.createElement("div");
      el.className = className;
      el.style.left = x + "px";
      el.style.top = y + "px";
      gameArea.appendChild(el);
      return el;
    }
    
    function randX() {
      // Pastikan objek tidak spawn di luar area jalan
      return Math.floor(Math.random() * (window.innerWidth - 70)); // 70 adalah lebar truk (terlebar)
    }
    
    function spawnAll() {
      if (Math.random() < 0.02) enemies.push(createObject("enemy", randX(), -80));
      if (Math.random() < 0.01) coins.push(createObject("coin", randX(), -50));
      if (Math.random() < 0.005) boosts.push(createObject("boost", randX(), -60));
      if (Math.random() < 0.003) shields.push(createObject("shield", randX(), -60));
      if (Math.random() < 0.008) trucks.push(createObject("truck", randX(), -100)); // Ganti 'dino'
    }
    
    function checkCollision(a, b) {
      const ar = a.getBoundingClientRect();
      const br = b.getBoundingClientRect();
      return !(
        ar.bottom < br.top ||
        ar.top > br.bottom ||
        ar.right < br.left ||
        ar.left > br.right
      );
    }
    
    function updateObjects(list, onHit, currentSpeed) {
      for (let i = list.length - 1; i >= 0; i--) {
        const el = list[i];
        el.style.top = el.offsetTop + currentSpeed + "px"; // Gunakan currentSpeed
        
        if (el.offsetTop > window.innerHeight) {
          el.remove();
          list.splice(i, 1);
        } else if (checkCollision(player, el)) {
          onHit(el);
          el.remove();
          list.splice(i, 1);
        }
      }
    }
    
    function loop() {
      if (!gameStarted) return;
      
      // Tentukan kecepatan game saat ini
      let currentSpeed = boostActive ? 12 : 5;
      
      // Kontrol Gerakan
      if (leftPressed || keyMap["ArrowLeft"]) movePlayer(-1);
      if (rightPressed || keyMap["ArrowRight"]) movePlayer(1);
      
      // Animasikan Jalan
      roadPos = (roadPos + currentSpeed) % 80; // 80 adalah tinggi pola jalan
      linePos = (linePos + currentSpeed) % 40; // 40 adalah tinggi pola garis
      road.style.backgroundPositionY = roadPos + "px";
      centerLine.style.backgroundPositionY = linePos + "px";
      
      // Update & Spawn Objek
      spawnAll();
      updateObjects(enemies, () => {
        if (!shieldActive) return gameOver();
      }, currentSpeed);
      
      updateObjects(coins, () => {
        score += 10;
      }, currentSpeed);
      
      updateObjects(boosts, () => {
        if (boostActive) return; // Jangan reset timer jika sudah aktif
        boostActive = true;
        player.classList.add("boost-active");
        setTimeout(() => {
          boostActive = false;
          player.classList.remove("boost-active");
        }, 3000);
      }, currentSpeed);
      
      updateObjects(shields, () => {
        if (shieldActive) return; // Jangan reset timer jika sudah aktif
        shieldActive = true;
        player.classList.add("shield-active");
        setTimeout(() => {
          shieldActive = false;
          player.classList.remove("shield-active");
        }, 5000);
      }, currentSpeed);
      
      updateObjects(trucks, () => { // Ganti 'dinos'
        if (!shieldActive) return gameOver();
      }, currentSpeed);
      
      // Update Skor
      score++;
      scoreText.textContent = "Score: " + score;
      
      requestAnimationFrame(loop);
    }
    
    function gameOver() {
      gameStarted = false; // Hentikan loop permainan
      
      // Tampilkan layar Game Over
      const goScreen = document.getElementById("gameOverScreen");
      const finalScoreEl = document.getElementById("finalScore");
      finalScoreEl.textContent = "Final Score: " + score;
      goScreen.style.display = "flex";
    }
    
    function restartGame() {
      location.reload(); // Cara termudah untuk me-restart game
    }
    
    function startCountdown() {
      document.getElementById("startScreen").style.display = "none";
      const cd = document.getElementById("countdown");
      let count = 3;
      cd.textContent = count;
      cd.style.display = "flex";
      
      let timer = setInterval(() => {
        count--;
        if (count > 0) {
          cd.textContent = count;
        } else {
          clearInterval(timer);
          cd.style.display = "none";
          startGame();
        }
      }, 1000);
    }
    
    function startGame() {
      gameStarted = true;
      requestAnimationFrame(loop);
    }
  </script>
</body>

</html>
